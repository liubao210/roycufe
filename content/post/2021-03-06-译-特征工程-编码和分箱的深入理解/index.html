---
title: '[译]特征工程 - 编码和分箱的深入理解'
author: baoliu
date: '2021-03-06'
slug: []
categories:
  - ML
tags:
  - ML
  - model
df_print: paged
output: 
  df_print: paged
  html_document:
    toc: true
    toc_depth: 4
    toc_float: 
      collapsed: false
      smooth_scroll: false
      
    df_print: paged
    theme: cerulean
---

<script src="index_files/header-attrs/header-attrs.js"></script>
<script src="index_files/htmlwidgets/htmlwidgets.js"></script>
<script src="index_files/jquery/jquery.min.js"></script>
<link href="index_files/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="index_files/datatables-binding/datatables.js"></script>
<link href="index_files/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="index_files/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="index_files/dt-core/js/jquery.dataTables.min.js"></script>
<link href="index_files/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="index_files/crosstalk/js/crosstalk.min.js"></script>
<script src="index_files/echarts4r/echarts-en.min.js"></script>
<script src="index_files/echarts4r/ecStat.min.js"></script>
<script src="index_files/echarts4r/dataTool.min.js"></script>
<script src="index_files/echarts4r-binding/echarts4r.js"></script>


<div id="简介" class="section level2">
<h2><strong>简介</strong></h2>
<p><strong>特征工程是数据科学中模型拟合的重要一步，这篇文章讲述了如何进行从分类变量到连续变量以及从连续变量到分类变量的转换。</strong></p>
<p><strong>分箱： 把连续变量转换为分类变量</strong><br />
<strong>编码： 把分类变量转换为连续变量</strong></p>
</div>
<div id="分箱" class="section level2">
<h2><strong>分箱</strong></h2>
<p>分箱(离散化)是指把连续型变量转换为分类特征的方法。常常能够提升模型表现，也能够帮助识别出离群值。<br />
分箱的方式可以分为两种：<br />
- 无监督的分箱： 等距分箱、等频分箱<br />
- 监督分箱：基于熵的分箱</p>
<div id="无监督分箱" class="section level3">
<h3><strong>无监督分箱</strong></h3>
<p>无监督的分箱无需考虑模型因变量。</p>
<div id="等距分箱" class="section level4">
<h4><strong>等距分箱</strong></h4>
<p>顾名思义，假如有一列数据为价格，按照10为一组就是等距分箱；</p>
<pre class="r"><code># 
price &lt;-  data.frame(
  price = floor(abs(rnorm(50, mean = 70 , sd = 20)))
  ) %&gt;% 
  arrange(price)

price$price </code></pre>
<pre><code>##  [1]  20  34  36  40  42  45  45  50  50  52  52  52  52  54  54  56  59  59  60
## [20]  60  62  62  63  65  68  68  69  71  71  72  72  73  73  74  75  75  76  80
## [39]  81  82  84  86  89  91  94  98  99  99 100 114</code></pre>
<pre class="r"><code>new_data &lt;- price %&gt;% 
  mutate(
    price_group = paste0(&quot;[&quot;, floor(price / 10), &quot;, &quot;,ceiling(price / 10), &quot;]&quot;),
    group_index = floor(price / 10)
  )

datatable(new_data)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],[20,34,36,40,42,45,45,50,50,52,52,52,52,54,54,56,59,59,60,60,62,62,63,65,68,68,69,71,71,72,72,73,73,74,75,75,76,80,81,82,84,86,89,91,94,98,99,99,100,114],["[2, 2]","[3, 4]","[3, 4]","[4, 4]","[4, 5]","[4, 5]","[4, 5]","[5, 5]","[5, 5]","[5, 6]","[5, 6]","[5, 6]","[5, 6]","[5, 6]","[5, 6]","[5, 6]","[5, 6]","[5, 6]","[6, 6]","[6, 6]","[6, 7]","[6, 7]","[6, 7]","[6, 7]","[6, 7]","[6, 7]","[6, 7]","[7, 8]","[7, 8]","[7, 8]","[7, 8]","[7, 8]","[7, 8]","[7, 8]","[7, 8]","[7, 8]","[7, 8]","[8, 8]","[8, 9]","[8, 9]","[8, 9]","[8, 9]","[8, 9]","[9, 10]","[9, 10]","[9, 10]","[9, 10]","[9, 10]","[10, 10]","[11, 12]"],[2,3,3,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,10,11]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>price<\/th>\n      <th>price_group<\/th>\n      <th>group_index<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>new_data %&gt;% 
  group_by(price_group, group_index) %&gt;% 
  summarise(freq = n()) %&gt;% 
  ungroup() %&gt;% 
  arrange(group_index) %&gt;% 
  e_charts(price_group) %&gt;% 
  e_bar(freq) %&gt;% 
  e_grid(left = &#39;7%&#39;, right = &#39;2%&#39;) %&gt;% 
  e_x_axis(axisLabel = list(interval = 0, rotate = 315))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;price_group&#39; (override with `.groups` argument)</code></pre>
<div id="htmlwidget-2" style="width:100%;height:500px;" class="echarts4r html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"theme":"","tl":false,"draw":true,"renderer":"canvas","events":[],"buttons":[],"opts":{"yAxis":[{"show":true}],"xAxis":[{"data":["[2, 2]","[3, 4]","[4, 4]","[4, 5]","[5, 5]","[5, 6]","[6, 6]","[6, 7]","[7, 8]","[8, 8]","[8, 9]","[9, 10]","[10, 10]","[11, 12]"],"type":"category","boundaryGap":true,"axisLabel":{"interval":0,"rotate":315}}],"legend":{"data":["freq"]},"series":[{"data":[{"value":["[2, 2]"," 1"]},{"value":["[3, 4]"," 2"]},{"value":["[4, 4]"," 1"]},{"value":["[4, 5]"," 3"]},{"value":["[5, 5]"," 2"]},{"value":["[5, 6]"," 9"]},{"value":["[6, 6]"," 2"]},{"value":["[6, 7]"," 7"]},{"value":["[7, 8]","10"]},{"value":["[8, 8]"," 1"]},{"value":["[8, 9]"," 5"]},{"value":["[9, 10]"," 5"]},{"value":["[10, 10]"," 1"]},{"value":["[11, 12]"," 1"]}],"name":"freq","type":"bar","yAxisIndex":0,"xAxisIndex":0,"coordinateSystem":"cartesian2d"}],"grid":[{"left":"7%","right":"2%"}]},"dispose":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="等频分箱" class="section level4">
<h4><strong>等频分箱</strong></h4>
<p>顾名思义，假如有一列数据为价格，把它分成等量的几组就是等距分箱；</p>
<pre class="r"><code># x指要分成的组数
x &lt;- 10
cat(&quot;一共要分成&quot;, x, &quot;组&quot;, &quot;每组&quot;, dim(price)[1] / 10, &quot;个&quot;)</code></pre>
<pre><code>## 一共要分成 10 组 每组 5 个</code></pre>
<pre class="r"><code>price_group_index &lt;- c(rep(1:10, each = dim(price)[1] / 10))

new_data &lt;- price %&gt;% 
  mutate(
    group_index = price_group_index
  ) %&gt;% 
  group_by(group_index) %&gt;% 
  mutate(price_group = paste0(&quot;[&quot;, min(price), &quot;, &quot;, max(price), &quot;]&quot;))
  

datatable(new_data)</code></pre>
<div id="htmlwidget-3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],[20,34,36,40,42,45,45,50,50,52,52,52,52,54,54,56,59,59,60,60,62,62,63,65,68,68,69,71,71,72,72,73,73,74,75,75,76,80,81,82,84,86,89,91,94,98,99,99,100,114],[1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10],["[20, 42]","[20, 42]","[20, 42]","[20, 42]","[20, 42]","[45, 52]","[45, 52]","[45, 52]","[45, 52]","[45, 52]","[52, 54]","[52, 54]","[52, 54]","[52, 54]","[52, 54]","[56, 60]","[56, 60]","[56, 60]","[56, 60]","[56, 60]","[62, 68]","[62, 68]","[62, 68]","[62, 68]","[62, 68]","[68, 72]","[68, 72]","[68, 72]","[68, 72]","[68, 72]","[72, 75]","[72, 75]","[72, 75]","[72, 75]","[72, 75]","[75, 82]","[75, 82]","[75, 82]","[75, 82]","[75, 82]","[84, 94]","[84, 94]","[84, 94]","[84, 94]","[84, 94]","[98, 114]","[98, 114]","[98, 114]","[98, 114]","[98, 114]"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>price<\/th>\n      <th>group_index<\/th>\n      <th>price_group<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>new_data %&gt;% 
  group_by(price_group, group_index) %&gt;% 
  summarise(freq = n()) %&gt;% 
  ungroup() %&gt;% 
  arrange(group_index) %&gt;% 
  e_charts(price_group) %&gt;% 
  e_bar(freq) %&gt;% 
  e_grid(left = &#39;7%&#39;, right = &#39;2%&#39;) %&gt;% 
  e_x_axis(axisLabel = list(interval = 0, rotate = 315))</code></pre>
<pre><code>## `summarise()` regrouping output by &#39;price_group&#39; (override with `.groups` argument)</code></pre>
<div id="htmlwidget-4" style="width:100%;height:500px;" class="echarts4r html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"theme":"","tl":false,"draw":true,"renderer":"canvas","events":[],"buttons":[],"opts":{"yAxis":[{"show":true}],"xAxis":[{"data":["[20, 42]","[45, 52]","[52, 54]","[56, 60]","[62, 68]","[68, 72]","[72, 75]","[75, 82]","[84, 94]","[98, 114]"],"type":"category","boundaryGap":true,"axisLabel":{"interval":0,"rotate":315}}],"legend":{"data":["freq"]},"series":[{"data":[{"value":["[20, 42]","5"]},{"value":["[45, 52]","5"]},{"value":["[52, 54]","5"]},{"value":["[56, 60]","5"]},{"value":["[62, 68]","5"]},{"value":["[68, 72]","5"]},{"value":["[72, 75]","5"]},{"value":["[75, 82]","5"]},{"value":["[84, 94]","5"]},{"value":["[98, 114]","5"]}],"name":"freq","type":"bar","yAxisIndex":0,"xAxisIndex":0,"coordinateSystem":"cartesian2d"}],"grid":[{"left":"7%","right":"2%"}]},"dispose":true},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="监督分箱" class="section level3">
<h3>监督分箱</h3>
<p>监督分箱是指在分箱的时候考虑目标分类结果，即根据已有目标分类结果来衡量怎么对一个连续型自变量分箱最好。</p>
<div id="基于熵的分箱" class="section level4">
<h4>基于熵的分箱</h4>
<p>在分箱的时候，计算目标类别的熵，并根据最大信息增益进行分箱。
简单的理解为，假设有一列商品价格，有一列是是否畅销商品，那么如果要把商品价格转换成分类变量，在转换的时候可以考虑怎么分箱可以使得分箱的结果最接近于是否畅销商品这一已有结果(使分箱结果与已有结果相吻合)。</p>
</div>
</div>
</div>
<div id="编码" class="section level2">
<h2>编码</h2>
<div id="标签编码" class="section level3">
<h3>标签编码</h3>
</div>
<div id="section" class="section level3">
<h3></h3>
</div>
</div>
